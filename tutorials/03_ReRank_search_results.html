
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Tutorial: Rerank search results using the ColBERT Reranker &#8212; PrimeQA  documentation</title>
<link rel="stylesheet" href="../_static/plex.css" type="text/css">

<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="icon" sizes="16x16" type="image/png" href="../_static/primeqa_logo.png" />
    <link rel="icon" sizes="32x32" type="image/png" href="../_static/primeqa_logo.png" />
    <link rel="apple-touch-icon" sizes="180x180" type="image/png" href="../_static/primeqa_logo.png" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<script async
    src="https://api.countapi.xyz/hit/mnlp-qa-dev-2.sl.cloud9.ibm.com/visits?callback=callbackCounter"></script>
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="light">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">PrimeQA: The Prime Repository for QA</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../development.html">
  Development
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../testing.html">
  Testing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/index.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="index.html">
  Tutorials
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/primeqa/primeqa/" rel="noopener" target="_blank" title="GitHub"><img src="https://badgen.net/github/stars/primeqa/primeqa?icon=github" class="icon-link-image" alt="GitHub"/></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://join.slack.com/t/primeqaworkspace/shared_invite/zt-1edc4fn7n-6aUO0CCvDOMOLb0drROwSw" rel="noopener" target="_blank" title="Slack"><img src="https://cdn.bfldr.com/5H442O3W/at/pl546j-7le8zk-6gwiyo/Slack_Mark.svg?auto=webp&format=png" class="icon-link-image" alt="Slack"/></a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><div class="custom-left-section" style="padding: 0 1.5rem">
        <h4 style="color: #c9d1d9">Getting started</h4>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z" />
                </svg>
                <strong><a href="../installation.html">Installation</a></strong>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M414.8 40.79L286.8 488.8C281.9 505.8 264.2 515.6 247.2 510.8C230.2 505.9 220.4 488.2 225.2 471.2L353.2 23.21C358.1 6.216 375.8-3.624 392.8 1.232C409.8 6.087 419.6 23.8 414.8 40.79H414.8zM518.6 121.4L630.6 233.4C643.1 245.9 643.1 266.1 630.6 278.6L518.6 390.6C506.1 403.1 485.9 403.1 473.4 390.6C460.9 378.1 460.9 357.9 473.4 345.4L562.7 256L473.4 166.6C460.9 154.1 460.9 133.9 473.4 121.4C485.9 108.9 506.1 108.9 518.6 121.4V121.4zM166.6 166.6L77.25 256L166.6 345.4C179.1 357.9 179.1 378.1 166.6 390.6C154.1 403.1 133.9 403.1 121.4 390.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4L121.4 121.4C133.9 108.9 154.1 108.9 166.6 121.4C179.1 133.9 179.1 154.1 166.6 166.6V166.6z" />
                </svg>
                <!-- <strong><a href="../development.html">Development</a></strong>
                <strong><a href="../development.html">Development</a></strong> -->
                <strong><a href="../development.html">Development</a></strong>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M502.6 169.4l-160-160C336.4 3.125 328.2 0 320 0s-16.38 3.125-22.62 9.375c-12.5 12.5-12.5 32.75 0 45.25l6.975 6.977l-271.4 271c-38.75 38.75-45.13 102-9.375 143.5C44.08 500 72.76 512 101.5 512h.4473c26.38 0 52.75-9.1 72.88-30.12l275.2-274.6l7.365 7.367C463.6 220.9 471.8 224 480 224s16.38-3.125 22.62-9.375C515.1 202.1 515.1 181.9 502.6 169.4zM310.6 256H200.2l149.3-149.1l55.18 55.12L310.6 256z" />
                </svg>
                <strong><a href="../testing.html">Testing</a></strong>
        </p>

        <h4 style="color: #c9d1d9">PrimeQA</h4>
        <!-- <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 1em; height: 1em;">
                        <path style="fill: #c9d1d9"
                                d="M232.5 5.171C247.4-1.718 264.6-1.718 279.5 5.171L498.1 106.2C506.6 110.1 512 118.6 512 127.1C512 137.3 506.6 145.8 498.1 149.8L279.5 250.8C264.6 257.7 247.4 257.7 232.5 250.8L13.93 149.8C5.438 145.8 0 137.3 0 127.1C0 118.6 5.437 110.1 13.93 106.2L232.5 5.171zM498.1 234.2C506.6 238.1 512 246.6 512 255.1C512 265.3 506.6 273.8 498.1 277.8L279.5 378.8C264.6 385.7 247.4 385.7 232.5 378.8L13.93 277.8C5.438 273.8 0 265.3 0 255.1C0 246.6 5.437 238.1 13.93 234.2L67.13 209.6L219.1 279.8C242.5 290.7 269.5 290.7 292.9 279.8L444.9 209.6L498.1 234.2zM292.9 407.8L444.9 337.6L498.1 362.2C506.6 366.1 512 374.6 512 383.1C512 393.3 506.6 401.8 498.1 405.8L279.5 506.8C264.6 513.7 247.4 513.7 232.5 506.8L13.93 405.8C5.438 401.8 0 393.3 0 383.1C0 374.6 5.437 366.1 13.93 362.2L67.13 337.6L219.1 407.8C242.5 418.7 269.5 418.7 292.9 407.8V407.8z" />
                </svg>
                <strong><a href="/_autosummary/primeqa.html#module-primeqa">API Reference</a></strong>
        </p> -->
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M172.1 40.16L268.1 3.76C280.9-1.089 295.1-1.089 307.9 3.76L403.9 40.16C425.6 48.41 440 69.25 440 92.52V204.7C441.3 205.1 442.6 205.5 443.9 205.1L539.9 242.4C561.6 250.6 576 271.5 576 294.7V413.9C576 436.1 562.9 456.2 542.5 465.1L446.5 507.3C432.2 513.7 415.8 513.7 401.5 507.3L288 457.5L174.5 507.3C160.2 513.7 143.8 513.7 129.5 507.3L33.46 465.1C13.13 456.2 0 436.1 0 413.9V294.7C0 271.5 14.39 250.6 36.15 242.4L132.1 205.1C133.4 205.5 134.7 205.1 136 204.7V92.52C136 69.25 150.4 48.41 172.1 40.16V40.16zM290.8 48.64C289 47.95 286.1 47.95 285.2 48.64L206.8 78.35L287.1 109.5L369.2 78.35L290.8 48.64zM392 210.6V121L309.6 152.6V241.8L392 210.6zM154.8 250.9C153 250.2 150.1 250.2 149.2 250.9L70.81 280.6L152 311.7L233.2 280.6L154.8 250.9zM173.6 455.3L256 419.1V323.2L173.6 354.8V455.3zM342.8 280.6L424 311.7L505.2 280.6L426.8 250.9C425 250.2 422.1 250.2 421.2 250.9L342.8 280.6zM528 413.9V323.2L445.6 354.8V455.3L523.2 421.2C526.1 419.9 528 417.1 528 413.9V413.9z" />
                </svg>
                <strong><a href="../api/index.html">API</a></strong>
        </p>

        <h4 style="color: #c9d1d9">Learn more</h4>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z" />
                </svg>
                <strong>Quick tour: Entry Points for PrimeQA</strong><br><a
                        href="https://github.com/primeqa/primeqa/tree/main/notebooks">Different entry points for
                        PrimeQA: Information Retrieval, Reading Comprehension, TableQA and Question Generation</a>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z" />
                </svg>
                <strong>Tutorials: Jupyter Notebooks</strong><br><a
                        href="https://github.com/primeqa/primeqa/tree/main/notebooks">Notebooks to get started on QA
                        tasks
                </a>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z" />
                </svg>
                <strong>Examples: Applying PrimeQA on various QA tasks</strong><br><a
                        href="https://github.com/primeqa/primeqa/tree/main/examples">Example scripts for fine-tuning
                        PrimeQA models on a range of QA tasks
                </a>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z" />
                </svg>
                <strong>Model sharing and uploading</strong><br><a
                        href="https://huggingface.co/docs/transformers/model_sharing">Upload and share your
                        fine-tuned models with the community</a>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z" />
                </svg>
                <strong>Pull Request</strong><br><a
                        href="../pull_request_template.html">PrimeQA Pull Request</a>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z" />
                </svg>
                <strong>Generate Documentation</strong><br><a
                        href="../README.html">How Documentation works</a>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z" />
                </svg>
                <strong>Orchestrator Service REST Microservice</strong><br><a
                        href="../orchestrator.html">Proof-of-concept code for PrimeQA Orchestrator microservice</a>
        </p>
        <p style="color: #c9d1d9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #c9d1d9"
                                d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z" />
                </svg>
                <strong>Tooling UI</strong><br><a
                        href="../tooling_ui.html">Demo UI</a>
        </p>
</div>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      <div class="custom-right-section" style="padding: 2rem 0 0 0">
        <button onclick="window.open('https://github.com/primeqa/primeqa/discussions','_blank')" class="bootstrap-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="width: 1em; height: 1em;">
                        <!-- Font Awesome Pro 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) -->
                        <path style="fill: #459db9"
                                d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z" />
                </svg>&nbsp;Start a Discussion!</button>
        <button onclick="showSource()" class="bootstrap-btn"><svg xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 640 512" style="width: 1em; height: 1em;">
                        <!--! Font Awesome Pro 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill: #459db9"
                                d="M414.8 40.79L286.8 488.8C281.9 505.8 264.2 515.6 247.2 510.8C230.2 505.9 220.4 488.2 225.2 471.2L353.2 23.21C358.1 6.216 375.8-3.624 392.8 1.232C409.8 6.087 419.6 23.8 414.8 40.79H414.8zM518.6 121.4L630.6 233.4C643.1 245.9 643.1 266.1 630.6 278.6L518.6 390.6C506.1 403.1 485.9 403.1 473.4 390.6C460.9 378.1 460.9 357.9 473.4 345.4L562.7 256L473.4 166.6C460.9 154.1 460.9 133.9 473.4 121.4C485.9 108.9 506.1 108.9 518.6 121.4V121.4zM166.6 166.6L77.25 256L166.6 345.4C179.1 357.9 179.1 378.1 166.6 390.6C154.1 403.1 133.9 403.1 121.4 390.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4L121.4 121.4C133.9 108.9 154.1 108.9 166.6 121.4C179.1 133.9 179.1 154.1 166.6 166.6V166.6z" />
                </svg>&nbsp;Show Source</button>
        <button onclick="hRefGitHub()" class="bootstrap-btn"><svg xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 576 512" style="width: 1em; height: 1em;">
                        <path style="fill: #459db9"
                                d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z" />
                </svg>&nbsp;Edit on GitHub</button>
        <!-- <p style="color: #459db9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="width: 1em; height: 1em;">
                        <path style="fill: #459db9"
                                d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z" />
                </svg>&nbsp;<span id="visits"></span>
        </p> -->
        <img src="_static/img/PrimeQA.png" alt="primeqa" width="100"
                style="display: block;margin-left: auto;margin-right: auto;" />
</div>

<script>
        function showSource() {
                window.open("../_sources/tutorials/03_ReRank_search_results.ipynb.txt", '_blank');
        }

        function hRefGitHub() {
                window.open('https://github.com/primeqa/primeqa/edit/main/docs/tutorials/03_ReRank_search_results.ipynb', '_blank');
        }
        // function callbackCounter(response) {
        //         document.getElementById('visits').innerText = response.value;
        // }
</script>
    </div>
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step-0:-Prepare-a-Colab-Environment-to-run-this-tutorial-on-GPUs">
   Step 0: Prepare a Colab Environment to run this tutorial on GPUs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step-1:-Install-PrimeQA">
   Step 1: Install PrimeQA
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step2:-Download-the-sample-corpus-and-the-ColBERT-DrDecr-model">
   Step2: Download the sample corpus and the ColBERT DrDecr model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step-3:-Pre-process-your-document-collection">
   Step 3: Pre-process your document collection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step-4:-Now-we-will-use-the-PrimeQA-BM25-Indexer-to-build-an-index">
   Step 4: Now we will use the PrimeQA BM25 Indexer to build an index
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step-5:-Start-asking-Questions">
   Step 5: Start asking Questions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step-6:-Rerank-the-BM25-search-results-with-a-Neural-Reranker">
   Step 6: Rerank the BM25 search results with a Neural Reranker
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step-7:-Run-the-Reranker">
   Step 7: Run the Reranker
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Step-8:-Print-the-top-ranked-result-before-and-after-reranking">
   Step 8: Print the top ranked result before and after reranking
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Congratulations-!!!-###-🎉✨🎊🥳">
     Congratulations !!! ### 🎉✨🎊🥳
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="Tutorial:-Rerank-search-results-using-the-ColBERT-Reranker">
<h1>Tutorial: Rerank search results using the ColBERT Reranker<a class="headerlink" href="#Tutorial:-Rerank-search-results-using-the-ColBERT-Reranker" title="Permalink to this headline">#</a></h1>
<p>In this tutorial, we will learn how to use a Neural Reranker to rerank results from a BM25 search. The reranker is based on the ColBERT algorithm as described in Khattab et al., “ColBERT: Efficient and Effective Passage Search via Contextualized Late Interaction over BERT” <a class="reference external" href="https://arxiv.org/pdf/2004.12832.pdf">here</a>.</p>
<p>For the purposes of making this tutorial easy to understand, we show the steps using a very small document collection. Note that this technique can be used to scale to millions of documents. We have tested upto 21 million Wikipedia passages!!!</p>
<p>The tutorial will take you through these three steps:</p>
<ol class="arabic simple">
<li><p>Build a BM25 index over a small sample collection</p></li>
<li><p>Query the BM25 index to obtain initial search results</p></li>
<li><p>Rerank the initial results with a neural reranker to obtain the final search results</p></li>
</ol>
<section id="Step-0:-Prepare-a-Colab-Environment-to-run-this-tutorial-on-GPUs">
<h2>Step 0: Prepare a Colab Environment to run this tutorial on GPUs<a class="headerlink" href="#Step-0:-Prepare-a-Colab-Environment-to-run-this-tutorial-on-GPUs" title="Permalink to this headline">#</a></h2>
<p>Make sure to “Enable GPU Runtime” by following this <a class="reference external" href="https://drive.google.com/file/d/1jhE8CkieQXoW0gvz9IherTDdJY54Q4Yz/view?usp=sharing">url</a>. This step will make sure the tutorial runs faster.</p>
</section>
<section id="Step-1:-Install-PrimeQA">
<h2>Step 1: Install PrimeQA<a class="headerlink" href="#Step-1:-Install-PrimeQA" title="Permalink to this headline">#</a></h2>
<p>First, we need to include the required modules.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip

<span class="c1"># Java 11 is required</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>install-jdk<span class="w"> </span>gdown

<span class="kn">import</span> <span class="nn">jdk</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/tmp/primeqa-jdk/jdk-11.0.19+7/&quot;</span><span class="p">):</span>
    <span class="n">jdk_dir</span> <span class="o">=</span> <span class="n">jdk</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/tmp/primeqa-jdk&quot;</span><span class="p">)</span>

<span class="c1"># set the JAVA_HOME environment variable to point to Java 11</span>
<span class="o">%</span><span class="k">env</span> JAVA_HOME=/tmp/primeqa-jdk/jdk-11.0.19+7/

<span class="c1"># install primeqa</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>primeqa
</pre></div>
</div>
</div>
<p>Next we set up some paths. Please update the <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> path to a location where you have write permissions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup paths</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;/tmp/primeqa-tutorial&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># create output directory if it does not exist</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

<span class="c1"># setup some paths</span>
<span class="n">downloaded_corpus_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s2">&quot;sample-document-store.csv&quot;</span><span class="p">)</span>
<span class="n">collection_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s2">&quot;sample_collection.tsv&quot;</span><span class="p">)</span>
<span class="n">reranker_model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;DrDecr.dnn&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Step2:-Download-the-sample-corpus-and-the-ColBERT-DrDecr-model">
<h2>Step2: Download the sample corpus and the ColBERT DrDecr model<a class="headerlink" href="#Step2:-Download-the-sample-corpus-and-the-ColBERT-DrDecr-model" title="Permalink to this headline">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># download the sample collection</span>
<span class="o">!</span><span class="w"> </span>gdown<span class="w">  </span>--id<span class="w"> </span>1LULJRPgN_hfuI2kG-wH4FUwXCCdDh9zh<span class="w"> </span>--output<span class="w"> </span><span class="o">{</span>output_dir<span class="o">}</span>/

<span class="c1"># Download the reranker model</span>
<span class="o">!</span><span class="w"> </span>wget<span class="w"> </span>-P<span class="w"> </span><span class="o">{</span>output_dir<span class="o">}</span><span class="w"> </span>https://huggingface.co/PrimeQA/DrDecr_XOR-TyDi_whitebox/resolve/main/DrDecr.dnn
</pre></div>
</div>
</div>
</section>
<section id="Step-3:-Pre-process-your-document-collection">
<h2>Step 3: Pre-process your document collection<a class="headerlink" href="#Step-3:-Pre-process-your-document-collection" title="Permalink to this headline">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preprocess the document colletion</span>
<span class="kn">from</span> <span class="nn">primeqa.ir.util.corpus_reader</span> <span class="kn">import</span> <span class="n">DocumentCollection</span>

<span class="n">collection</span> <span class="o">=</span> <span class="n">DocumentCollection</span><span class="p">(</span><span class="n">downloaded_corpus_file</span><span class="p">)</span>
<span class="n">collection</span><span class="o">.</span><span class="n">write_corpus_tsv</span><span class="p">(</span><span class="n">collection_file</span><span class="p">)</span>

<span class="o">!</span><span class="w"> </span>head<span class="w"> </span>-2<span class="w"> </span><span class="o">{</span>collection_file<span class="o">}</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-4:-Now-we-will-use-the-PrimeQA-BM25-Indexer-to-build-an-index">
<h2>Step 4: Now we will use the PrimeQA BM25 Indexer to build an index<a class="headerlink" href="#Step-4:-Now-we-will-use-the-PrimeQA-BM25-Indexer-to-build-an-index" title="Permalink to this headline">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">primeqa.components.indexer.sparse</span> <span class="kn">import</span> <span class="n">BM25Indexer</span>

<span class="c1"># Instantiate and configure the indexer</span>
<span class="n">indexer</span> <span class="o">=</span> <span class="n">BM25Indexer</span><span class="p">(</span><span class="n">index_root</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="s2">&quot;sample_index_bm25&quot;</span><span class="p">)</span>
<span class="n">indexer</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>   <span class="c1"># IMPORTANT: required to configure</span>

<span class="c1"># Index the collection</span>
<span class="n">indexer</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection_file</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Step-5:-Start-asking-Questions">
<h2>Step 5: Start asking Questions<a class="headerlink" href="#Step-5:-Start-asking-Questions" title="Permalink to this headline">#</a></h2>
<p>We’re now ready to query the index we created.</p>
<p>Each search hit is a tuple consisting of <code class="docutils literal notranslate"><span class="pre">(document_id,score)</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">primeqa.components.retriever.sparse</span>  <span class="kn">import</span> <span class="n">BM25Retriever</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Exmaple questions</span>
<span class="n">question</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Why was Einstein awarded the Nobel Prize?&quot;</span><span class="p">]</span>

<span class="c1"># Instantiate and configure the retriever</span>
<span class="n">retriever</span> <span class="o">=</span> <span class="n">BM25Retriever</span><span class="p">(</span><span class="n">index_root</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="s2">&quot;sample_index_bm25&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">retriever</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="c1"># Search</span>
<span class="n">hits</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">max_num_documents</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Step-6:-Rerank-the-BM25-search-results-with-a-Neural-Reranker">
<h2>Step 6: Rerank the BM25 search results with a Neural Reranker<a class="headerlink" href="#Step-6:-Rerank-the-BM25-search-results-with-a-Neural-Reranker" title="Permalink to this headline">#</a></h2>
<p>We will be using the DrDecr model trained on Natural Questions and XOR TyDI. This is a model that has obtained SOTA results on the XORTyDI Retrieval task.</p>
<p>Here are the steps we will take:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1. Fetch the documents corresponding to the BM25 search hits
2. Initialize the PrimeQA ColBERTReranker
3. Rerank the BM25 search results
</pre></div>
</div>
<p>The reranker encodes the question and passage texts using the Reranker model and uses the representations to compute a similarity score.</p>
<p>We will use the DocumentCollection instance to fetch the document corresponding to the BM25 search results.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fetch documents</span>
<span class="n">hits_to_be_reranked</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">add_document_text_to_hit</span><span class="p">(</span><span class="n">hits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">hits_to_be_reranked</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="Step-7:-Run-the-Reranker">
<h2>Step 7: Run the Reranker<a class="headerlink" href="#Step-7:-Run-the-Reranker" title="Permalink to this headline">#</a></h2>
<p>Next we will initialize the ColBERT Reranker with the DrDecr model and rerank the BM25 search results</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the ColBERT Reranker</span>
<span class="kn">from</span> <span class="nn">primeqa.components.reranker.colbert_reranker</span> <span class="kn">import</span> <span class="n">ColBERTReranker</span>

<span class="c1"># Instantiate the ColBERTReranker</span>
<span class="n">reranker</span> <span class="o">=</span> <span class="n">ColBERTReranker</span><span class="p">(</span><span class="n">reranker_model_path</span><span class="p">)</span>
<span class="n">reranker</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="c1"># rerank the BM25 search result and output the top 3 hits</span>
<span class="n">reranked_results</span> <span class="o">=</span> <span class="n">reranker</span><span class="o">.</span><span class="n">rerank</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="p">[</span><span class="n">hits_to_be_reranked</span><span class="p">],</span> <span class="n">max_num_documents</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">reranked_results</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Step-8:-Print-the-top-ranked-result-before-and-after-reranking">
<h2>Step 8: Print the top ranked result before and after reranking<a class="headerlink" href="#Step-8:-Print-the-top-ranked-result-before-and-after-reranking" title="Permalink to this headline">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print top ranked results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;QUESTON: </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">========Top search result BEFORE reranking&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hits_to_be_reranked</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;document&#39;</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>  <span class="n">hits_to_be_reranked</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;document&#39;</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">========Top search result AFTER reranking&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reranked_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;document&#39;</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>  <span class="n">reranked_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;document&#39;</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>
<br/></pre></div>
</div>
</div>
<section id="Congratulations-!!!-###-🎉✨🎊🥳">
<h3>Congratulations !!! ### 🎉✨🎊🥳<a class="headerlink" href="#Congratulations-!!!-###-🎉✨🎊🥳" title="Permalink to this headline">#</a></h3>
<p>You have successfully completed the Reranker tutorial !</p>
</section>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
</div>
</footer>
  </body>
</html>